<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title class="Lang">index</title>
  <!-- <link href="../../css/weyu/input.css" rel="stylesheet"> -->
  <!-- <link href="../../css/zz/board1.css" rel="stylesheet"> -->
  <!-- <link href="../../css/weyu/loading.css" rel="stylesheet"> -->
  <link href="../../css/weyu/weyu_right_navbar.css" rel="stylesheet">
  <link href="dashboard11.css" rel="stylesheet">
  <link rel="stylesheet" href="../../css/comm/cdn.tailwindcss.com.css">
  <script src="../../js/comm/cdn.tailwindcss.com.js"></script>
</head>
<body onload="onLoad()">
  <div id="allWrapper" class="relative text-sm z-10">
    <header class="flex items-center w-full mt-2">
      <div class="box-header flex">
      <button id="toggleButton" class="text-white font-bold p-2 pl-4">
        <img src="../../img/comm/icons/hamburger.svg" alt="Menu" />
      </button>
    
      <a id="logotext" href="../../index.html" class="text-white text-xl font-bold">ESG</a>
    
      <nav id="navbar" class="fixed z-10 top-0 left-0 bg-black hidden-navbar h-screen overflow-hidden w-full transition-all duration-200 bg-opacity-60">
        <div class="bg-blue-950 w-2/3 lg:w-1/4 h-screen">
          <div class="flex items-center">
            
            <button id="closeButton" class="text-white font-bold p-4">
              <img src="../../img/comm/icons/close.svg" alt="Menu" />
            </button>

            <button type="button" class="text-white text-xl font-bold" id="menu_name">ESG</button>

          </div>
          
          <div id="menuList"></div>
          
        </div>
      </nav>
    </div>
      
       <div class="box-header">
      <div id="title" class="justify-center text-sky-200 font-bold flex flex-grow items-center Lang">ISO-50001碳足跡管理系統</div>
    </div>
      <div class="box-header">
      <div id="timming" class="text-sky-300 mr-20 mt-2">14:30</div>

      <div id="settings" class="mt-2">
        <img id="settings-image" src="../../img/comm/user-gear-solid.svg" style="height: 1.5rem; width: 1.5rem" alt="Settings" />
      </div>

      <div id="dropdown-menu" class="dropdown-content hidden">
        <div id="langueStatus">Language Status</div>
        <div id="accountStatus">Account Status</div>
        <div id="changePassword">修改密碼</div>
        <div id="logout">Logout</div>
      </div>
    </div>
    </header>

    <div class="flex flex-col lg:flex-row lg:flex-wrap xl:flex-nowrap p-4 pt-0 pb-0 mt-2">

      <div class="order-2 xl:order-1 flex flex-col md:flex-row xl:flex-col w-full xl:w-1/5 pb-3 mb-2 xl:h-[50vh]">
        <div id="chartA" class="chartBox h-half relative pt-7 lg:pt-2 pb-3 sm:w-full md:w-1/3 lg:w-1/4 xl:w-full xl:mb-2 ">
          <!-- <a href="kanban/EMS-Ekanban-kW.html"> -->
          <div id="doughnutAKID" class="absolute pt-5 text-sky-200 w-full text-center"></div>
          <h2 id="doughnutATitle" class="font-bold text-md text-sky-300 text-center"></h2>
          <div id="doughnutAWrapper" class="wrapper">
            <canvas id="doughnutAChart"></canvas>
            <!-- <canvas id="doughnutAChart" width="250" height="250"></canvas> -->
          </div>
          <!-- </a> -->
        </div>

        <div id="gridAContainer" class="chartBox h-half  flex justify-between flex-wrap w-full md:w-2/3 lg:w-3/4 xl:w-full">
          <div class="w-1/2 p-1" id="air-flow">
            <div class="bg-blue-600 rounded-lg p-2 h-full bg-opacity-30">
              <table class="w-full table-auto">
                <thead>
                  <tr>
                    <th colspan="2" class="text-white text-center font-bold w-full Lang">Air Flow Today(Nm3)</th>
                  </tr>
                </thead>
                <tbody class="text-white" id="air-flow-content">
                  <tr>
                    <td colspan="2" class="border-b border-gray-400 my-4"></td>
                  </tr>
                  <!-- <tr class="mt-1">
                    <td class="pr-4 pt-2">FAB1</td>
                    <td class="pt-2">112345</td>
                  </tr> -->
                </tbody>
              </table>
            </div>
          </div>
          
          <div class="w-1/2 p-1" id="n-flow">
            <div class="bg-blue-600 rounded-lg p-2 h-full bg-opacity-30">
              <table class="w-full table-auto">
                <thead>
                  <tr>
                    <th colspan="2" class="text-white text-center font-bold w-full Lang">Nitrogen Flow Today(Nm3)</th>
                  </tr>
                </thead>
                <tbody class="text-white" id="n-flow-content">
                  <!-- <tr>
                    <td colspan="2" class="border-b border-gray-400 my-4"></td>
                  </tr>
                  <tr class="mt-1">
                    <td class="pr-4 pt-2">FAB1</td>
                    <td class="pt-2">112345</td>
                  </tr> -->
                </tbody>
              </table>
            </div>
          </div>
          
          <div class="w-1/2 p-1" id="tap-water">
            <div class="bg-blue-600 rounded-lg p-2 h-full bg-opacity-30">
              <table class="w-full table-auto">
                <thead>
                  <tr>
                    <th colspan="2" class="text-white text-center font-bold w-full Lang">City Water Today (L)</th>
                  </tr>
                </thead>
                <tbody class="text-white" id="tap-water-content">
                  <!-- <tr>
                    <td colspan="2" class="border-b border-gray-400 my-4"></td>
                  </tr>
                  <tr class="mt-1">
                    <td class="pr-4 pt-2">FAB1</td>
                    <td class="pt-2">112345</td>
                  </tr> -->
                </tbody>
              </table>
            </div>
          </div>

          <div class="w-1/2 p-1" id="waste-water">
            <div class="bg-blue-600 rounded-lg p-2 h-full bg-opacity-30">
              <table class="w-full table-auto">
                <thead>
                  <tr>
                    <th colspan="2" class="text-white text-center font-bold w-full Lang">Wastewater Today (L)</th>
                  </tr>
                </thead>
                <tbody class="text-white" id="waste-water-content">
                  <!-- <tr>
                    <td colspan="2" class="border-b border-gray-400 my-4"></td>
                  </tr>
                  <tr class="mt-1">
                    <td class="pr-4 pt-2">FAB1</td>
                    <td class="pt-2">112345</td>
                  </tr> -->
                </tbody>
              </table>
            </div>
          </div>

        </div>
      </div>
      
      <div class="order-1 xl:order-2 lg:w-full xl:w-3/5 xl:m-2 xl:mt-0 mb-2">
        <div class="chartBox h-half p-2 mb-2">
          <h2 id="stackBarATitle" class="font-bold text-lg text-sky-300 text-center"></h2>
          <div id="stackBarAWrapper" class="wrapper" style="position: relative;">
            <div style="position: absolute; top: 95%; left: 25px; color: white; font-size: 12px; white-space: nowrap; pointer-events: none;">
              kWh
            </div>
            <div id="stackAContainer">
              <canvas id="stackBarA"></canvas>
            </div>
            <div style="position: absolute; top: 95%; right: 15px; color: white; font-size: 12px; white-space: nowrap; pointer-events: none;">
              CO2e(T)
            </div>
            <!-- <canvas id="stackBarA"  width="30" height="9"></canvas> -->
          </div>
        </div>

        <div class="chartBox h-half  p-2 mb-2 text-sky-200">
          <canvas id="multiLineA"></canvas>
          <h2 id="gridBTitle" class="font-bold text-lg text-sky-300 text-center pt-1"></h2>
          <div id="gridBContainer" class="pt-3"></div>
        </div>
      </div>

      <div class="order-3 xl:order-3 lg:w-full xl:w-1/5 mb-2">
        <div class="chartBox h-half p-2 mb-2">
          <h2 id="stackBarBTitle" class="font-bold text-lg text-sky-300 text-center"></h2>
          <div class="wrapper" style="position: relative;">
            <!-- <div style="position: absolute; top: 90%; left: 5px; color: white; font-size: 10px; white-space: nowrap; pointer-events: none;">
              CO2e(T)
            </div> -->
            <!-- <canvas id="stackBarB"></canvas> -->
            <canvas id="regressionChart" width="800" height="800"></canvas>
            <!-- <canvas id="lineMulti" width="210" height="210"></canvas> -->
          </div>
        </div>

        <div id="gridC" class="chartBox h-half  p-2 mb-2">
          <h2 id="gridCTitle" class="font-bold text-lg text-sky-300 text-center pt-1 Lang">Carbon Per 7 Days</h2>
          <!-- <div id="gridCContainer" class="pa-1 overflow-hidden hover:overflow-y-scroll"></div> -->
          <div id="gridCContainer" class="pa-1">
            <div class="wrapper">
              <canvas id="horizonalBarC"></canvas>
            </div>
          </div>
        </div>
      </div>

    </div>
    
    <div id="footer" class="fixed bottom-0 w-full"></div>

  </div>
  <div class="absolute top-0 bottom-0 right-0 left-0 mainBG flex flex-col"></div>

    <script src="../../js/comm/jquery.min.js"></script>
    <script src="../../js/weyu/weyu_config.js"></script>
    <script src="../../js/weyu/weyu_comm_api_function.js"></script>
    <script src="../../js/weyu/weyu_comm_function.js"></script>
    <script src="../../js/weyu/weyu_check.js"></script>
    <script src="../../js/comm/cdn.jsdelivr.net_npm_chart.js"></script>
  <script src="../../js/weyu/weyu_header.js"></script>
  <script src="../../js/weyu/weyu_footer.js"></script>
  <script src="dashboard11.js"></script>
  <!-- <script src="../../js/weyu/weyu_loading.js"></script> -->
  <script src="../../js/weyu/weyu_right_navbar.js"></script>
  <script src="../../js/weyu/weyu_menu.js"></script>

  <!-- 多語系翻譯 -->
  <script type="text/javascript">
    function onLoad() {
        GetConfig();
        SetDefaultSelectLang();
        ChangeLang();//多國語言翻譯
        swapWeb();
    };
    // 左上LOGO文字
       // $('#logotext').html(PROJECT_SAVE_NAME);

    // const protocol = window.location.protocol
    // function changeLink() {
    //   console.log('頁面加載完畢，準備開始跳轉...')
    //   setInterval(function() {
    //     window.location.href = `${protocol}//${default_ip}/${PROJECT_NAME}/${kanbanRoute}/kanban/EMS-Ekanban.html`
    //   }, 30000)
    // }

    // $(document).ready(function() {
    //   changeLink()
    // })
</script>
<script>
  function openChangePwdModal(){
    // 添加modal到網頁中
    if($("#changePwdModal").length === 0){
        $("body").append(`
            <div id="changePwdModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex justify-center items-center z-50 hidden">
                <div class="bg-white rounded-lg shadow-lg w-full max-w-md mx-4">
                    <div class="flex justify-between items-center border-b p-4">
                        <h5 class="text-xl font-medium text-gray-800" id="changePwdModalLabel">${GetLangDataV2('Change Password')}</h5>
                        <button type="button" class="text-gray-400 hover:text-gray-600" onclick="closeChangePwdModal()">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="p-4">
                        <div class="mb-4">
                            <label for="newPassword" class="block text-sm font-medium text-gray-700">${GetLangDataV2('New password')}</label>
                            <input type="password" id="newPassword" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div class="mb-4">
                            <label for="newPassword_Check" class="block text-sm font-medium text-gray-700">${GetLangDataV2('Confirm password:')}</label>
                            <input type="password" id="newPassword_Check" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                    </div>
                    <div class="flex justify-end border-t p-4">
                        <button type="button" class="bg-gray-200 text-gray-800 rounded-lg px-4 py-2 mr-2 hover:bg-gray-300" onclick="closeChangePwdModal()">${GetLangDataV2('Cancel')}</button>
                        <button type="button" class="bg-blue-600 text-white rounded-lg px-4 py-2 hover:bg-blue-700" id="savePwdChange">${GetLangDataV2('Save')}</button>
                    </div>
                </div>
            </div>
        `)
          $("#savePwdChange").click(()=>{
              let yes = confirm('確定要修改登入密碼嗎?')
              if(yes){
                  if($("#newPassword").val().length < 8){
                      alert('The password must be at least 8 characters!')
                  }else if(!validatePassword($("#newPassword").val())){
                      alert('密碼必需包含下列4種字元中的3種： 英文大寫字元(A到Z) 英文小寫字元(a到z) 10進位數字(0到9) 特殊符號(例如：!、 $、#、%)')
                  }else if($("#newPassword").val() !== $("#newPassword_Check").val()){
                      alert('輸入密碼不一致!')
                  }else{
                      // alert('密碼修改成功!')
                      // var account = localStorage.getItem(PROJECT_SAVE_NAME + '_BI_userName')
                      var account = localStorage.getItem(PROJECT_SAVE_NAME + '_BI_accountNo')
                      var is_go = true;
                      var sid = "";
                      $.ajax({
                          type: 'POST',
                          url: window.location.protocol+'//'+default_ip+'/'+default_WebSiteName+'/MasterSet/ResetPassword.ashx',
                          data: { action: 'GetAccountNo', account: account },
                          async: false,
                          success: function (msg) {
                              resultJson = JSON.parse(msg);
                              if (resultJson.result == "true") {
                                  sid = resultJson.sid;
                              }
                              else {
                                  is_go = false;
                                  alert("密碼修改失敗")
                              }
                          }
                      });
                      if(is_go){
                          $.ajax({
                              type: 'POST',
                              url: window.location.protocol+'//'+default_ip+'/'+default_WebSiteName+'/MasterSet/ResetPassword.ashx',
                              data: { action: 'ResetPassword', sid: sid, password: $('#newPassword').val() },
                              async: false,
                              success: function (msg) {
                                  resultJson = JSON.parse(msg);
                                  if (resultJson.result == "true") {
                                      $('#newPassword,#newPassword_Check').val('')
                                      alert('密碼修改成功!')
                                      $("#changePwdModal").modal('hide')
                                  }
                                  else {
                                      alert('密碼修改失敗!!')
                                  }
                              }
                          });
                      }
                  }
              }
              function validatePassword(password) {
                const hasUpperCase = /[A-Z]/.test(password);
                const hasLowerCase = /[a-z]/.test(password);
                const hasNumber = /[0-9]/.test(password);
                const hasSpecialChar = /[!$#%]/.test(password);
                
                // 計算符合的字元類型數量
                const typesCount = [hasUpperCase, hasLowerCase, hasNumber, hasSpecialChar].filter(Boolean).length;
                
                return typesCount >= 2;
              }
          })
        }
    // 打開 modal
    $("#changePwdModal").removeClass('hidden').addClass('flex')

   

}
function closeChangePwdModal() {
    $("#changePwdModal").removeClass('flex').addClass('hidden');
}

// 左上LOGO文字
$('#logotext').html(PROJECT_SAVE_NAME);
</script>
</body>
</html>